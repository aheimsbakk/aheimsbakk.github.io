<!DOCTYPE html>
<html lang="en">
<head>
          <title>> /dev/null > 2>&1</title>
        <meta charset="utf-8" />
        <link href="http://blog.heimsbakk.net/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="> /dev/null > 2>&1 Full Atom Feed" />
        <link href="http://blog.heimsbakk.net/feeds/blog.atom.xml" type="application/atom+xml" rel="alternate" title="> /dev/null > 2>&1 Categories Atom Feed" />



    <meta name="tags" contents="howto" />
    <meta name="tags" contents="pulseaudio" />
    <meta name="tags" contents="sound" />

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="../../">> /dev/null > 2>&1 <strong></strong></a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
            <li><a href="/index.html">home</a></li>
            <li><a href="#">|</a></li>
              <li class="active"><a href="../../category/blog.html">blog</a></li>
              <li><a href="../../category/uris.html">uris</a></li>
        </ul></nav><!-- /#menu -->
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="../../posts/2015/2015-01-10-pa.html" rel="bookmark"
         title="Permalink to Record a PulseAudio sound stream">Record a PulseAudio sound stream</a></h2>
 
  </header>
  <footer class="post-info">
    <abbr class="published" title="2015-01-10T00:00:00">
      lø. 10 januar 2015
    </abbr>
    <address class="vcard author">
      By           <a class="url fn" href="../../author/arnulf.html">arnulf</a>
    </address>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <p>Ever wondered on how to record the audio from one application? Either the browser or a streaming application that don't have the option to save audio to a file.</p>
<p>The <a href="https://en.wikipedia.org/wiki/PulseAudio">PulseAudio</a> sound server in your desktop makes this quite easy.</p>
<p>I've created a small script that captures the current playing sound stream and redirects it to <a href="https://en.wikipedia.org/wiki/Flac" title="Free Lossless Audio Codec">FLAC</a> audio file. After the capture is started, you can start playing sound from other programs. It won't interfere with the current capture.</p>
<h2>Capture audio</h2>
<h3>Pre requests</h3>
<p>You have to install a couple of programs, if you don't have them from before, to make the bash script work.</p>
<div class="highlight"><pre>apt-get install pulseaudio-utils flac coreutils
</pre></div>


<h3>The script</h3>
<p>This is my <code>record-app.sh</code> script.</p>
<div class="highlight"><pre><span class="c">#!/bin/bash</span>

<span class="nv">BN</span><span class="o">=</span><span class="k">$(</span>basename <span class="nv">$0</span><span class="k">)</span>
<span class="nv">SI</span><span class="o">=</span><span class="k">$(</span>pacmd list-sink-inputs | grep -m 1 index | egrep -o <span class="s2">&quot;[[:digit:]]+&quot;</span><span class="k">)</span>

<span class="k">if</span> <span class="o">[[</span> <span class="s2">&quot;$1&quot;</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="o">]]</span>; <span class="k">then</span>
<span class="k">  </span><span class="nb">echo</span> <span class="s2">&quot;usage: $BN filename&quot;</span>
  <span class="nb">exit </span>1
<span class="k">fi</span>

<span class="k">if</span> <span class="o">[[</span> <span class="s2">&quot;$SI&quot;</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="o">]]</span>; <span class="k">then</span>
<span class="k">  </span><span class="nb">echo</span> <span class="s2">&quot;error: no input sinks found&quot;</span>
  <span class="nb">exit </span>2
<span class="k">fi</span>

<span class="nv">N</span><span class="o">=</span><span class="s2">&quot;$1&quot;</span>

<span class="nb">echo</span> <span class="nv">$BN</span> recording:
<span class="nb">echo</span> · Found sink index «<span class="nv">$SI</span>»
<span class="nb">echo</span> · Loading module-null-sink
<span class="nv">MI</span><span class="o">=</span><span class="k">$(</span>pactl load-module module-null-sink <span class="nv">sink_name</span><span class="o">=</span>rec<span class="k">)</span>
<span class="nb">trap</span> <span class="s2">&quot;{ echo · Trying to delete null sink «rec»; pactl unload-module $MI; }&quot;</span> EXIT
<span class="nb">echo</span> · Moving sink «<span class="nv">$SI</span>» to null sink «rec»
pactl move-sink-input <span class="nv">$SI</span> rec
<span class="nb">echo</span> · Saving sound data to «<span class="nv">$N</span>.flac» 
parec -d rec.monitor | flac --endian<span class="o">=</span>little --sign<span class="o">=</span>signed --channels<span class="o">=</span>2 --bps<span class="o">=</span>16n --sample-rate<span class="o">=</span>44100 -o <span class="s2">&quot;$1.flac&quot;</span> - 2&gt;/dev/null
</pre></div>


<h3>Usage</h3>
<div class="highlight"><pre>usage: record-app.sh filename
</pre></div>


<h4>Example 1</h4>
<div class="highlight"><pre>./record-app.sh firefox-sound
</pre></div>


<p>Will start to record the current playing audio in Firefox. The audio is saved int the file <code>firefox-sound.flac</code>.</p>
<h4>Example 2</h4>
<div class="highlight"><pre>timeout 1h ./record-app.sh firefox-sound
</pre></div>


<p>Will record the current playing audio in Firefox for one hour, and then automatically quit. Audio saved to <code>firefox-sound.flac</code> in this example too.</p>
<h2>Caveats</h2>
<ul>
<li>If the file you record to exists, the program automatically quits</li>
<li>To ensure capture of the sound, only play sound from one program</li>
<li>Using the timeout command will yield in a non fatal error on exit</li>
<li>
<p>While capturing, no sound will be played through the speakers</p>
<p>A workaround for this is to start playing the captured file. It won't interfere with the capture of the sound. </p>
</li>
</ul>
<h6>vim: set syn=markdown spell spl=en:</h6>
  </div><!-- /.entry-content -->
</section>
        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>