<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		
		<meta name="author" content="Arnulf Heimsbakk">
		<meta name="description" content="Sysadmin that blogs when life get boring">
		<meta name="generator" content="Hugo 0.69.0" />
		<title>Record a PulseAudio sound stream &middot; &gt; /dev/null 2&gt;&amp;1</title>
		<link rel="shortcut icon" href="https://blog.heimsbakk.net/images/favicon.ico">
		<link rel="stylesheet" href="https://blog.heimsbakk.net/css/style.css">
		<link rel="stylesheet" href="https://blog.heimsbakk.net/css/highlight.css">

		
		<link rel="stylesheet" href="https://blog.heimsbakk.net/css/font-awesome.min.css">
		

		
		<link href="https://blog.heimsbakk.net/index.xml" rel="alternate" type="application/rss+xml" title="&gt; /dev/null 2&gt;&amp;1" />
		

		
		<link rel="stylesheet" href="https://blog.heimsbakk.net/css/code-size.css">
		
		<link rel="stylesheet" href="https://blog.heimsbakk.net/css/width.css">
		
	</head>

    <body>
       <nav class="main-nav">
	
	
		<a href='https://blog.heimsbakk.net/'> <span class="arrow">←</span>Home</a>
	
	<a href='https://blog.heimsbakk.net/posts'>Archive</a>
	<a href='https://blog.heimsbakk.net/categories'>Categories</a>
	<a href='https://blog.heimsbakk.net/tags'>Tags</a>
	<a href='https://blog.heimsbakk.net/about'>About</a>

	

	
	<a class="cta" href="https://blog.heimsbakk.net/index.xml">Subscribe</a>
	
</nav>


        <section id="wrapper" class="post">
            <article>
                <header>
                    <h1>
                        Record a PulseAudio sound stream
                    </h1>
                    <h2 class="headline">
                    Jan 10, 2015 00:00
                    · 348 words
                    · 2 minute read
                      <span class="tags">
                      
                      
                          
                              <a href="https://blog.heimsbakk.net/tags/howto">howto</a>
                          
                              <a href="https://blog.heimsbakk.net/tags/pulseaudio">pulseaudio</a>
                          
                      
                      
                      </span>
                    </h2>
                </header>
                
                <section id="post-body">
                    <p>Ever wondered on how to record the audio from one application? Either the browser or a streaming application that don&rsquo;t have the option to save audio to a file.</p>
<p>The <a href="https://en.wikipedia.org/wiki/PulseAudio">PulseAudio</a> sound server in your desktop makes this quite easy.</p>
<p>I&rsquo;ve created a small script that captures the current playing sound stream and redirects it to <a href="https://en.wikipedia.org/wiki/Flac" title="Free Lossless Audio Codec">FLAC</a> audio file. After the capture is started, you can start playing sound from other programs. It won&rsquo;t interfere with the current capture.</p>
<h2 id="capture-audio">Capture audio</h2>
<h3 id="pre-requests">Pre requests</h3>
<p>You have to install a couple of programs, if you don&rsquo;t have them from before, to make the bash script work.</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">apt-get install pulseaudio-utils flac coreutils
</code></pre></div><h3 id="the-script">The script</h3>
<p>This is my <code>record-app.sh</code> script.</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#!/bin/bash
</span><span style="color:#75715e"></span>
<span style="color:#111">BN</span><span style="color:#f92672">=</span><span style="color:#00a8c8">$(</span>basename <span style="color:#111">$0</span><span style="color:#00a8c8">)</span>
<span style="color:#111">SI</span><span style="color:#f92672">=</span><span style="color:#00a8c8">$(</span>pacmd list-sink-inputs <span style="color:#111">|</span> grep -m <span style="color:#ae81ff">1</span> index <span style="color:#111">|</span> egrep -o <span style="color:#d88200">&#34;[[:digit:]]+&#34;</span><span style="color:#00a8c8">)</span>

<span style="color:#00a8c8">if</span> <span style="color:#f92672">[[</span> <span style="color:#d88200">&#34;</span><span style="color:#111">$1</span><span style="color:#d88200">&#34;</span> <span style="color:#f92672">==</span> <span style="color:#d88200">&#34;&#34;</span> <span style="color:#f92672">]]</span><span style="color:#111">;</span> <span style="color:#00a8c8">then</span>
  <span style="color:#111">echo</span> <span style="color:#d88200">&#34;usage: </span><span style="color:#111">$BN</span><span style="color:#d88200"> filename&#34;</span>
  <span style="color:#111">exit</span> <span style="color:#ae81ff">1</span>
<span style="color:#00a8c8">fi</span>

<span style="color:#00a8c8">if</span> <span style="color:#f92672">[[</span> <span style="color:#d88200">&#34;</span><span style="color:#111">$SI</span><span style="color:#d88200">&#34;</span> <span style="color:#f92672">==</span> <span style="color:#d88200">&#34;&#34;</span> <span style="color:#f92672">]]</span><span style="color:#111">;</span> <span style="color:#00a8c8">then</span>
  <span style="color:#111">echo</span> <span style="color:#d88200">&#34;error: no input sinks found&#34;</span>
  <span style="color:#111">exit</span> <span style="color:#ae81ff">2</span>
<span style="color:#00a8c8">fi</span>

<span style="color:#111">N</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;</span><span style="color:#111">$1</span><span style="color:#d88200">&#34;</span>

<span style="color:#111">echo</span> <span style="color:#111">$BN</span> recording:
<span style="color:#111">echo</span> · Found sink index «<span style="color:#111">$SI</span>»
<span style="color:#111">echo</span> · Loading module-null-sink
<span style="color:#111">MI</span><span style="color:#f92672">=</span><span style="color:#00a8c8">$(</span>pactl load-module module-null-sink <span style="color:#111">sink_name</span><span style="color:#f92672">=</span>rec<span style="color:#00a8c8">)</span>
<span style="color:#111">trap</span> <span style="color:#d88200">&#34;{ echo · Trying to delete null sink «rec»; pactl unload-module </span><span style="color:#111">$MI</span><span style="color:#d88200">; }&#34;</span> EXIT
<span style="color:#111">echo</span> · Moving sink «<span style="color:#111">$SI</span>» to null sink «rec»
pactl move-sink-input <span style="color:#111">$SI</span> rec
<span style="color:#111">echo</span> · Saving sound data to «<span style="color:#111">$N</span>.flac»
parec -d rec.monitor <span style="color:#111">|</span> flac --endian<span style="color:#f92672">=</span>little --sign<span style="color:#f92672">=</span>signed --channels<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> --bps<span style="color:#f92672">=</span>16n --sample-rate<span style="color:#f92672">=</span><span style="color:#ae81ff">44100</span> -o <span style="color:#d88200">&#34;</span><span style="color:#111">$1</span><span style="color:#d88200">.flac&#34;</span> - 2&gt;/dev/null
</code></pre></div><h3 id="usage">Usage</h3>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">usage: record-app.sh filename
</code></pre></div><h4 id="example-1">Example 1</h4>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">./record-app.sh firefox-sound
</code></pre></div><p>Will start to record the current playing audio in Firefox. The audio is saved int the file <code>firefox-sound.flac</code>.</p>
<h4 id="example-2">Example 2</h4>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">timeout 1h ./record-app.sh firefox-sound
</code></pre></div><p>Will record the current playing audio in Firefox for one hour, and then automatically quit. Audio saved to <code>firefox-sound.flac</code> in this example too.</p>
<h2 id="caveats">Caveats</h2>
<ul>
<li>
<p>If the file you record to exists, the program automatically quits</p>
</li>
<li>
<p>To ensure capture of the sound, only play sound from one program</p>
</li>
<li>
<p>Using the timeout command will yield in a non fatal error on exit</p>
</li>
<li>
<p>While capturing, no sound will be played through the speakers</p>
<p>A workaround for this is to start playing the captured file. It won&rsquo;t interfere with the capture of the sound.</p>
</li>
</ul>

                </section>
            </article>

            

            

            

            <footer id="footer">
    
        <div id="social">

	
	
    <a class="symbol" href="https://github.com/aheimsbakk">
        <i class="fa fa-github-square"></i>
    </a>
    
    <a class="symbol" href="https://www.linkedin.com/in/arnulfheimsbakk">
        <i class="fa fa-linkedin-square"></i>
    </a>
    
    <a class="symbol" href="https://twitter.com/aheimsbakk">
        <i class="fa fa-twitter-square"></i>
    </a>
    


</div>

    
    <p class="small">
    
       © Copyright 2020 <i class="fa fa-heart" aria-hidden="true"></i> Arnulf Heimsbakk
    
    </p>
    <p class="small">
        Powered by <a href="http://www.gohugo.io/">Hugo</a> Theme By <a href="https://github.com/nodejh/hugo-theme-cactus-plus">nodejh</a>
    </p>
</footer>

        </section>

        <script src="https://blog.heimsbakk.net/js/jquery-3.3.1.min.js"></script>
<script src="https://blog.heimsbakk.net/js/main.js"></script>
<script src="https://blog.heimsbakk.net/js/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>







    </body>
</html>
